(function(g,h){function j(a,c){this.element=a;this.options=g.extend({},o,c);this._defaults=o;this._name=e;this.init()}var e="thread",o={blocks:null,blockClass:e+"-block",columnClass:e+"-column",layout:{columnNumber:{"mobile-vertical":1,"mobile-horizontal":1,ereader:1,"tablet-vertical":1,"tablet-horizontal":1,desktop:2,"desktop-large":3},gutter:"4%"},animation:{effect:"fadeIn",duration:500},onInitial:function(){},onOneLoad:function(){},onAllLoad:function(){}},l=0;j.prototype={init:function(){var a=
this;this.$grid=jQuery(this.element);this.$grid.css({position:"relative"});this.$blocks=[];this.blocks=null!==this.options.blocks?this.options.blocks:this.options.blockClass!=this._defaults.blockClass?jQuery(this.options.blockClass):jQuery("."+this.options.blockClass);this.blockNumber=this.blocks.length;this.calculateGrid().createColumns(this.columnNumber);this.renderBlock(0,this.columnNumber);jQuery(h).resize(function(c){console.log(c);var c=a.columnNumber,d=a.gutter,b=a.calculateGrid(),f=b.columnNumber;
if(c!=f)h.location.reload();else{console.log(b.columnWidth,b.gutter);var i=b.gutter-d;jQuery(b.$blocks).each(function(b){b>=f&&jQuery(this).css({marginTop:jQuery(this).css("margin-top")-i})});1<f&&b.$columns.each(function(a){jQuery(this).css({width:b.columnWidth,left:b.columnWidth*a+b.gutter*a});console.log(b.columnWidth,"column"+a);b.calculateShortest(i*a,jQuery(this))})}})},renderBlock:function(a,c){if(a<this.blockNumber){var d=this,b=jQuery(this.blocks[a]).attr("id",this.options.blockClass+"-"+
(a+1)).addClass(this.options.blockClass),f=b.find("img"),i=f.length,e=this.minColumn,g=jQuery(e);g.height();var h=this.options.animation,k=h.duration,m=this.gutter,n={margin:0,padding:0,width:"100%",marginTop:this.gutter},j=function(){m+=b.height();1<c&&d.calculateShortest(m,g);d.options.onOneLoad(b);d.$blocks.push(b);d.renderBlock(a+1,c)};console.log(b);b.appendTo(e).hide();"fadeIn"==h.effect?b.delay(k*l).fadeIn(k).css(n):"slideDown"==h.effect?b.delay(k*l).slideDown(k).css(n):b.show().css(n);a<c&&
b.css({margin:0});l++;if(0<i)f.on("load",j);else j()}else if(a==this.blockNumber)this.options.onAllLoad()},analyzeUnits:function(a,c){var d=a.toString();return-1<d.search("px")||-1<d.search("em")?a:parseFloat(a)/100*c},createColumns:function(a){var c,d=this.columnWidth,b=this.gutter,f=this.options.columnClass;for(c=0;c<a;c++){var i=jQuery("<div></div>").attr("id",f+"-"+(c+1)).addClass(f);1<a&&i.css({position:"absolute",width:d,left:d*c+b*c});this.$grid.append(i)}this.$columns=jQuery("."+this.options.columnClass);
1<a?this.calculateShortest():this.minColumn=this.$columns[0];console.log(this.minColumn)},calculateShortest:function(a,c){c&&c.css({height:c.height()+a});var d=this.$columns,b=[],b=d.map(function(b,a){return jQuery(a).height()});this.minColumn=d.map(function(a,c){if(jQuery(c).height()==Math.min.apply(null,b))return c})[0];this.maxColumn=d.map(function(a,c){if(jQuery(c).height()==Math.max.apply(null,b))return c})[0];this.$grid.height(jQuery(this.maxColumn).height())},calculateGrid:function(){this.windowWidth=
jQuery(h).width();this.gridWidth=this.$grid.innerWidth();this.gutter=this.analyzeUnits(this.options.layout.gutter,this.gridWidth);this.currentHeight=0;360>=this.windowWidth?this.layout="mobile-vertical":480>=this.windowWidth&&360<this.windowWidth?this.layout="mobile-horizontal":768>=this.windowWidth&&480<this.windowWidth?this.layout="ereader":980>=this.windowWidth&&768<this.windowWidth?this.layout="tablet-vertical":1024>=this.windowWidth&&980<this.windowWidth?this.layout="tablet-horizontal":1200>=
this.windowWidth&&1024<this.windowWidth?this.layout="desktop":1200<this.windowWidth&&(this.layout="desktop-large");this.columnNumber=this.options.layout.columnNumber[this.layout];this.columnWidth=(this.gridWidth-(this.columnNumber-1)*this.gutter)/this.columnNumber;console.log(this);return this}};g.fn[e]=function(a){return this.each(function(){g.data(this,"plugin_"+e)||g.data(this,"plugin_"+e,new j(this,a))})}})(jQuery,window,document);