(function(e,n){function f(c,a){this.element=c;this.options=e.extend({},l,a);this._defaults=l;this._name=d;this.init()}var d="thread",l={blocks:null,blockClass:d+"-block",columnClass:d+"-column",layout:{columnWidth:0,columnNumber:{"mobile-vertical":1,"mobile-horizontal":1,ereader:1,"tablet-vertical":1,"default":2,desktop:3},gutter:"4%"},animation:{effect:!1,duration:500},onInitial:function(){},onOneLoad:function(){},onAllLoad:function(){}},g=0;f.prototype={init:function(){this.$grid=jQuery(this.element);
this.$grid.css({position:"relative"});this.$blocks=null!==this.options.blocks?this.options.blocks:this.options.blockClass!=this._defaults.blockClass?jQuery(this.options.blockClass):jQuery("."+this.options.blockClass);this.blockNumber=this.$blocks.length;this.calculateGrid().createColumns(this.columnNumber);this.renderBlock(0)},renderBlock:function(c){if(g<this.blockNumber){var a=this,b=jQuery(this.$blocks[c]).attr("id",this.options.blockClass+"-"+(c+1)).addClass(this.options.blockClass),m=b.find("img"),
o=m.length,h=this.gutter,d=this.minColumn,e=jQuery(d),j={position:"absolute",margin:0,padding:0,width:"100%",top:e.height(),left:0},f=function(){h+=b.height();a.calculateShortest(h,e);a.options.onOneLoad(b);a.renderBlock(c+1)},k=this.options.animation,i=k.duration;b.appendTo(d).hide();"fadeIn"==k.effect?b.delay(i*g).fadeIn(i).css(j):"slideDown"==k.effect?b.delay(i*g).slideDown(i).css(j):b.show().css(j);g++;if(0<o)m.on("load",f);else f()}else if(g==this.blockNumber)this.options.onAllLoad()},analyzeUnits:function(c,
a){var b=c.toString();return-1<b.search("px")||-1<b.search("em")?c:parseFloat(c)/100*a},createColumns:function(c){var a,b=this.options.layout.columnWidth,d=this.gutter,e=this.options.columnClass;for(a=0;a<c;a++){var h=jQuery("<div></div>").attr("id",e+"-"+(a+1)).addClass(e).width(b).css({position:"absolute",left:b*a+d*a});this.$grid.append(h)}this.$columns=jQuery("."+this.options.columnClass);this.calculateShortest()},calculateShortest:function(c,a){a&&a.css({height:a.height()+c});var b=this.$columns,
d=[],d=b.map(function(a,b){return jQuery(b).height()});this.minColumn=b.map(function(a,b){if(jQuery(b).height()==Math.min.apply(null,d))return b})[0];this.maxColumn=b.map(function(b,a){if(jQuery(a).height()==Math.max.apply(null,d))return a})[0];this.$grid.height(jQuery(this.maxColumn).height())},calculateGrid:function(){this.windowWidth=jQuery(n).width();this.gridWidth=this.$grid.innerWidth();this.gutter=this.analyzeUnits(this.options.layout.gutter,this.gridWidth);this.currentHeight=0;this.layout=
360>=this.windowWidth?"mobile-vertical":480>=this.windowWidth&&360<this.windowWidth?"mobile-horizontal":767>=this.windowWidth&&480<this.windowWidth?"ereader":979>=this.windowWidth&&767<this.windowWidth?"tablet-vertical":1199>=this.windowWidth&&979<this.windowWidth?"default":"desktop";this.columnNumber=this.options.layout.columnNumber[this.layout];this.options.layout.columnWidth=(this.gridWidth-(this.columnNumber-1)*this.gutter)/this.columnNumber;console.log(this);return this}};e.fn[d]=function(c){return this.each(function(){e.data(this,
"plugin_"+d)||e.data(this,"plugin_"+d,new f(this,c))})}})(jQuery,window,document);